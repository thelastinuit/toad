axios.interceptors.request.use((config) => {
  config.paramsSerializer = (params) => {
    return Qs.stringify(params, { arrayFormat: "brackets", encode: false })
  }
  return config
})

new Vue({
  el: '#app',
  vuetify: new Vuetify(),
  data: 
  { search: '',
    selected: [],
    selectedHeaders: [],
    count: 0,
    loading: true,
    options: {},
    values: [],
    hashedValues: {
      "EdibleCategory": {"category": "edible"},
      "PoisonousCategory": {"category": "poisonous"},
      "BellCapShape": {"capShape": "bell"},
      "ConicalCapShape": {"capShape": "conical"},
      "ConvexCapShape": {"capShape": "convex"},
      "FlatCapShape": {"capShape": "flat"},
      "KnobbedCapShape": {"capShape": "knobbed"},
      "SunkenCapShape": {"capShape": "sunken"},
      "FibrousCapSurface": {"capSurface": "fibrous"},
      "GroovesCapSurface": {"capSurface": "grooves"},
      "ScalyCapSurface": {"capSurface": "scaly"},
      "SmoothCapSurface": {"capSurface": "smooth"},
      "BrownCapColor": {"capColor": "brown"},
      "BuffCapColor": {"capColor": "buff"},
      "CinnamonCapColor": {"capColor": "cinnamon"},
      "GrayCapColor": {"capColor": "gray"},
      "GreenCapColor": {"capColor": "green"},
      "PinkCapColor": {"capColor": "pink"},
      "PurpleCapColor": {"capColor": "purple"},
      "RedCapColor": {"capColor": "red"},
      "WhiteCapColor": {"capColor": "white"},
      "YellowCapColor": {"capColor": "yellow"},
      "AlmondOdor": {"odor": "almond"},
      "AniseOdor": {"odor": "anise"},
      "CreosoteOdor": {"odor": "creosote"},
      "FishyOdor": {"odor": "fishy"},
      "FoulOdor": {"odor": "foul"},
      "MustyOdor": {"odor": "musty"},
      "NoneOdor": {"odor": "none"},
      "PungentOdor": {"odor": "pungent"},
      "SpicyOdor": {"odor": "spicy"},
      "Bruises": {"bruises": true},
      "NoBruises": {"bruises": false},
      "AttachedGillAttachment": {"gillAttachment": "attached"},
      "DescendingGillAttachment": {"gillAttachment": "descending"},
      "FreeGillAttachment": {"gillAttachment": "free"},
      "NotchedGillAttachment": {"gillAttachment": "notched"},
      "CloseGillSpacing": {"gillSpacing": "close"},
      "CrowdedGillSpacing": {"gillSpacing": "crowded"},
      "DistantGillSpacing": {"gillSpacing": "distant"},
      "BroadGillSize": {"gillSize": "broad"},
      "NarrowGillSize": {"gillSize": "narrow"},
      "BlackGillColor": {"gillColor": "black"},
      "BrownGillColor": {"gillColor": "brown"},
      "BuffGillColor": {"gillColor": "buff"},
      "ChocolateGillColor": {"gillColor": "chocolate"},
      "GrayGillColor": {"gillColor": "gray"},
      "GreenGillColor": {"gillColor": "green"},
      "OrangeGillColor": {"gillColor": "orange"},
      "PinkGillColor": {"gillColor": "pink"},
      "PurpleGillColor": {"gillColor": "purple"},
      "RedGillColor": {"gillColor": "red"},
      "WhiteGillColor": {"gillColor": "white"},
      "YellowGillColor": {"gillColor": "yellow"},
      "EnlargingStalkShape": {"stalkShape": "enlarging"},
      "TaperingStalkShape": {"stalkShape": "tapering"},
      "BulbousStalkRoot": {"stalkRoot": "bulbous"},
      "ClubStalkRoot": {"stalkRoot": "club"},
      "CupStalkRoot": {"stalkRoot": "cup"},
      "EqualStalkRoot": {"stalkRoot": "equal"},
      "RhizomorphsStalkRoot": {"stalkRoot": "rhizomorphs"},
      "RootedStalkRoot": {"stalkRoot": "rooted"},
      "MissingStalkRoot": {"stalkRoot": "missing"},
      "FibrousStalkSurfaceAboveRing": {"stalkSurfaceAboveRing": "fibrous"},
      "ScalyStalkSurfaceAboveRing": {"stalkSurfaceAboveRing": "scaly"},
      "SilkyStalkSurfaceAboveRing": {"stalkSurfaceAboveRing": "silky"},
      "SmoothStalkSurfaceAboveRing": {"stalkSurfaceAboveRing": "smooth"},
      "FibrousStalkSurfaceBelowRing": {"stalkSurfaceBelowRing": "fibrous"},
      "ScalyStalkSurfaceBelowRing": {"stalkSurfaceBelowRing": "scaly"},
      "SilkyStalkSurfaceBelowRing": {"stalkSurfaceBelowRing": "silky"},
      "SmoothStalkSurfaceBelowRing": {"stalkSurfaceBelowRing": "smooth"},
      "BrownStalkColorAboveRing": {"stalkColorAboveRing": "brown"},
      "BuffStalkColorAboveRing": {"stalkColorAboveRing": "buff"},
      "CinnamonStalkColorAboveRing": {"stalkColorAboveRing": "cinnamon"},
      "GrayStalkColorAboveRing": {"stalkColorAboveRing": "gray"},
      "OrangeStalkColorAboveRing": {"stalkColorAboveRing": "orange"},
      "PinkStalkColorAboveRing": {"stalkColorAboveRing": "pink"},
      "RedStalkColorAboveRing": {"stalkColorAboveRing": "red"},
      "WhiteStalkColorAboveRing": {"stalkColorAboveRing": "white"},
      "YellowStalkColorAboveRing": {"stalkColorAboveRing": "yellow"},
      "BrownStalkColorBelowRing": {"stalkColorBelowRing": "brown"},
      "BuffStalkColorBelowRing": {"stalkColorBelowRing": "buff"},
      "CinnamonStalkColorBelowRing": {"stalkColorBelowRing": "cinnamon"},
      "GrayStalkColorBelowRing": {"stalkColorBelowRing": "gray"},
      "OrangeStalkColorBelowRing": {"stalkColorBelowRing": "orange"},
      "PinkStalkColorBelowRing": {"stalkColorBelowRing": "pink"},
      "RedStalkColorBelowRing": {"stalkColorBelowRing": "red"},
      "WhiteStalkColorBelowRing": {"stalkColorBelowRing": "white"},
      "YellowStalkColorBelowRing": {"stalkColorBelowRing": "yellow"},
      "PartialVeilType": {"veilType": "partial"},
      "UniversalVeilType": {"veilType": "universal"},
      "BrownVeilColor": {"veilColor": "brown"},
      "OrangeVeilColor": {"veilColor": "orange"},
      "WhiteVeilColor": {"veilColor": "white"},
      "YellowVeilColor": {"veilColor": "yellow"},
      "NoneRingNumber": {"ringNumber": "none"},
      "OneRingNumber": {"ringNumber": "one"},
      "TwoRingNumber": {"ringNumber": "two"},
      "CobwebbyRingType": {"ringType": "cobwebby"},
      "EvanescentRingType": {"ringType": "evanescent"},
      "FlaringRingType": {"ringType": "flaring"},
      "LargeRingType": {"ringType": "large"},
      "NoneRingType": {"ringType": "none"},
      "PendantRingType": {"ringType": "pendant"},
      "SheathingRingType": {"ringType": "sheathing"},
      "ZoneRingType": {"ringType": "zone"},
      "BlackSporePrintColor": {"sporePrintColor": "black"},
      "BrownSporePrintColor": {"sporePrintColor": "brown"},
      "BuffSporePrintColor": {"sporePrintColor": "buff"},
      "ChocolateSporePrintColor": {"sporePrintColor": "chocolate"},
      "GreenSporePrintColor": {"sporePrintColor": "green"},
      "OrangeSporePrintColor": {"sporePrintColor": "orange"},
      "PurpleSporePrintColor": {"sporePrintColor": "purple"},
      "WhiteSporePrintColor": {"sporePrintColor": "white"},
      "YellowSporePrintColor": {"sporePrintColor": "yellow"},
      "AbundantPopulation": {"population": "abundant"},
      "ClusteredPopulation": {"population": "clustered"},
      "NumberousPopulation": {"population": "numberous"},
      "ScatteredPopulation": {"population": "scattered"},
      "SeveralPopulation": {"population": "several"},
      "SolitaryPopulation": {"population": "solitary"},
      "GrassesHabitat": {"habitat": "grasses"},
      "LeavesHabitat": {"habitat": "leaves"},
      "MeadowsHabitat": {"habitat": "meadows"},
      "PathsHabitat": {"habitat": "paths"},
      "UrbanHabitat": {"habitat": "urban"},
      "WasteHabitat": {"habitat": "waste"},
      "WoodsHabitat": {"habitat": "woods"}
    },
    headers: [
      { text: 'Category', value: 'category' },
      { text: 'Cap Shape', value: 'capShape' },
      { text: 'Cap Surface', value: 'capSurface' },
      { text: 'Cap Color', value: 'capColor' },
      { text: 'Odor', value: 'odor' },
      { text: 'Bruises', value: 'bruises' },
      { text: 'Gill Attachment', value: 'gillAttachment' },
      { text: 'Gill Spacing', value: 'gillSpacing' },
      { text: 'Gill Size', value: 'gillSize' },
      { text: 'Gill Color', value: 'gillColor' },
      { text: 'Stalk Shape', value: 'stalkShape' },
      { text: 'Stalk Root', value: 'stalkRoot' },
      { text: 'Stalk Surface Above Ring', value: 'stalkSurfaceAboveRing' },
      { text: 'Stalk Surface Below Ring', value: 'stalkSurfaceBelowRing' },
      { text: 'Stalk Color Above Ring', value: 'stalkColorAboveRing' },
      { text: 'Stalk Color Below Ring', value: 'stalkColorBelowRing' },
      { text: 'Veil Type', value: 'veilType' },
      { text: 'Veil Color', value: 'veilColor' },
      { text: 'Ring Number', value: 'ringNumber' },
      { text: 'Ring Type', value: 'ringType' },
      { text: 'Spore Print Color', value: 'sporePrintColor' },
      { text: 'population', value: 'population' },
      { text: 'habitat', value: 'habitat' }
    ],
    items: [
      "Bruises",
      "No Bruises",
      "Edible Category",
      "Poisonous Category",
      "Bell Cap Shape",
      "Conical Cap Shape",
      "Convex Cap Shape",
      "Flat Cap Shape",
      "Knobbed Cap Shape",
      "Sunken Cap Shape",
      "Fibrous Cap Surface",
      "Grooves Cap Surface",
      "Scaly Cap Surface",
      "Smooth Cap Surface",
      "Brown Cap Color",
      "Buff Cap Color",
      "Cinnamon Cap Color",
      "Gray Cap Color",
      "Green Cap Color",
      "Pink Cap Color",
      "Purple Cap Color",
      "Red Cap Color",
      "White Cap Color",
      "Yellow Cap Color",
      "Almond Odor",
      "Anise Odor",
      "Creosote Odor",
      "Fishy Odor",
      "Foul Odor",
      "Musty Odor",
      "None Odor",
      "Pungent Odor",
      "Spicy Odor",
      "Attached Gill Attachment",
      "Descending Gill Attachment",
      "Free Gill Attachment",
      "Notched Gill Attachment",
      "Close Gill Spacing",
      "Crowded Gill Spacing",
      "Distant Gill Spacing",
      "Broad Gill Size",
      "Narrow Gill Size",
      "Black Gill Color",
      "Brown Gill Color",
      "Buff Gill Color",
      "Chocolate Gill Color",
      "Gray Gill Color",
      "Green Gill Color",
      "Orange Gill Color",
      "Pink Gill Color",
      "Purple Gill Color",
      "Red Gill Color",
      "White Gill Color",
      "Yellow Gill Color",
      "Enlarging Stalk Shape",
      "Tapering Stalk Shape",
      "Bulbous Stalk Root",
      "Club Stalk Root",
      "Cup Stalk Root",
      "Equal Stalk Root",
      "Rhizomorphs Stalk Root",
      "Rooted Stalk Root",
      "Missing Stalk Root",
      "Fibrous Stalk Surface Above Ring",
      "Scaly Stalk Surface Above Ring",
      "Silky Stalk Surface Above Ring",
      "Smooth Stalk Surface Above Ring",
      "Fibrous Stalk Surface Below Ring",
      "Scaly Stalk Surface Below Ring",
      "Silky Stalk Surface Below Ring",
      "Smooth Stalk Surface Below Ring",
      "Brown Stalk Color Above Ring",
      "Buff Stalk Color Above Ring",
      "Cinnamon Stalk Color Above Ring",
      "Gray Stalk Color Above Ring",
      "Orange Stalk Color Above Ring",
      "Pink Stalk Color Above Ring",
      "Red Stalk Color Above Ring",
      "White Stalk Color Above Ring",
      "Yellow Stalk Color Above Ring",
      "Brown Stalk Color Below Ring",
      "Buff Stalk Color Below Ring",
      "Cinnamon Stalk Color Below Ring",
      "Gray Stalk Color Below Ring",
      "Orange Stalk Color Below Ring",
      "Pink Stalk Color Below Ring",
      "Red Stalk Color Below Ring",
      "White Stalk Color Below Ring",
      "Yellow Stalk Color Below Ring",
      "Partial Veil Type",
      "Universal Veil Type",
      "Brown Veil Color",
      "Orange Veil Color",
      "White Veil Color",
      "Yellow Veil Color",
      "None Ring Number",
      "One Ring Number",
      "Two Ring Number",
      "Cobwebby Ring Type",
      "Evanescent Ring Type",
      "Flaring Ring Type",
      "Large Ring Type",
      "None Ring Type",
      "Pendant Ring Type",
      "Sheathing Ring Type",
      "Zone Ring Type",
      "Black Spore Print Color",
      "Brown Spore Print Color",
      "Buff Spore Print Color",
      "Chocolate Spore Print Color",
      "Green Spore Print Color",
      "Orange Spore Print Color",
      "Purple Spore Print Color",
      "White Spore Print Color",
      "Yellow Spore Print Color",
      "Abundant Population",
      "Clustered Population",
      "Numberous Population",
      "Scattered Population",
      "Several Population",
      "Solitary Population",
      "Grasses Habitat",
      "Leaves Habitat",
      "Meadows Habitat",
      "Paths Habitat",
      "Urban Habitat",
      "Waste Habitat",
      "Woods Habitat"],
    mushrooms: [],
  },
  mounted () {
    this.selectedHeaders = [...this.headers]
    this.debouncedGetMushrooms(this, { mushroom: { capShape: '' }})
  },
  watch: {
    values(newValue, oldValue) {
      this.selected = newValue
      this.debouncedGetMushrooms(this, newValue, oldValue)
    },     
    selected() {
      this.search = ''
    },
    options: {
      handler() {
        this.debouncedGetMushrooms(this, this.selected)
      },
      deep: true,
    },
  },
  methods: {
    debouncedGetMushrooms: _.debounce((self, newValue, oldValue) => {
      params = self.parseParams()
      self.getMushrooms(self, params)
    }, 500),
    remove(item) {
      const index = this.values.indexOf(item)
      if (index >= 0) this.values.splice(index, 1)
    },
    parseParams() {
      if (!this.selected[0])
        return { mushroom: { capShape: '' }}

      mushroomObject = { mushroom: {} }
      this.selected.forEach((item) => {
        key = item.split(" ").join("")
        hashedValue = this.hashedValues[key]
        mushroomObject = { mushroom: Object.assign({}, mushroomObject.mushroom, hashedValue) }
      }) 
      return mushroomObject
    },
    getMushrooms(self, params) {
      self.loading = true
      return axios.get("/mushrooms", { 
        headers: { 
          'Accept': 'application/vnd.toad.v1+json', 
        },
        params: params
      })
        .then((response) => {
          self.mushrooms = response.data.mushrooms
          self.count = response.data.pagy.count
          self.loading = false
        })
        .catch((err) => {
          self.loading = false
        })
    },
  },
})
